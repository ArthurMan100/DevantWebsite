<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Checkout</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <style>
        .fixed-width {
            width: 70px;
        }
        .cart-section {
            margin: 0 auto;
            width: 33.33%;
        }
    </style>
    <script src="https://www.paypal.com/sdk/js?client-id=AaNX2rgoobFu-XwrA6vq0fNfOE5Zd4rDRdct70DEyz8MLL_I7KdCoO24CgbQwmzleqcaE2NGkurTCqY6&currency=USD"></script>
</head>
<body class="bg-body-tertiary">
{% include "header.html" %}

<div class="container-fluid">
  <main>
    <div class="py-5 text-center">
      <img class="d-block mx-auto mb-4" src="static/assets/img/logo1.png" alt="" height="100">
      <h2>Checkout form</h2>
      <p class="lead">Select the products and quantities you wish to purchase.</p>
    </div>

    <hr class="my-4">

    <h3 class="display-8 fw-bold text-body-emphasis">Select Product and Quantity</h3>
    <div class="container-fluid">
      <div class="row">
        <div class="col-md-6">
          <div class="d-flex align-items-center mb-2">
            <label class="form-check-label me-2" for="quantity-ginger-black-s">Ginger Black T Shirt - Small</label>
            <select class="form-select form-select-sm fixed-width product-quantity" id="quantity-ginger-black-s" data-price="34.99" aria-label="Quantity for Ginger Black T Shirt - Small">
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
            </select>
          </div>
          <div class="d-flex align-items-center mb-2">
            <label class="form-check-label me-2" for="quantity-ginger-black-m">Ginger Black T Shirt - Medium</label>
            <select class="form-select form-select-sm fixed-width product-quantity" id="quantity-ginger-black-m" data-price="34.99" aria-label="Quantity for Ginger Black T Shirt - Medium">
              <option value="0">0</option>
              <option value="1">1</option>
              <option value="2">2</option>
              <option value="3">3</option>
              <option value="4">4</option>
              <option value="5">5</option>
            </select>
          </div>
          <!-- Add other product options similarly -->
        </div>
        <div class="col-md-6">
          <div class="row">
            <div class="col-md-6">
              <img src="static/assets/img/tshirt_1.png" class="img-fluid" alt="Ginger Black T Shirt">
            </div>
            <div class="col-md-6">
              <img src="static/assets/img/tshirt_2.png" class="img-fluid" alt="Love Life Misc. White T Shirt">
            </div>
          </div>
        </div>
      </div>
    </div>

    <hr class="my-4">

    <div class="row g-5">
      <div class="col-md-12">
        <div class="cart-section">
          <h4 class="d-flex justify-content-between align-items-center mb-3">
            <span class="text-primary">Your cart</span>
            <span class="badge bg-primary rounded-pill" id="cart-count">0</span>
          </h4>
          <ul class="list-group mb-3" id="cart-items">
            <!-- Cart items will be dynamically inserted here -->
          </ul>
          <li class="list-group-item d-flex justify-content-between">
            <span>Total (USD)</span>
            <strong id="cart-total">$0.00</strong>
          </li>
          <div id="paypal-button-container"></div>
        </div>
      </div>
    </div>
  </main>


  <footer class="my-5 pt-5 text-body-secondary text-center text-small">
    <p class="mb-1">© 2017–2024 Company Name</p>
    <ul class="list-inline">
      <li class="list-inline-item"><a href="#">Privacy</a></li>
      <li class="list-inline-item"><a href="#">Terms</a></li>
      <li class="list-inline-item"><a href="#">Support</a></li>
    </ul>
  </footer>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
  const quantities = document.querySelectorAll('.product-quantity');
  const cartItems = document.getElementById('cart-items');
  const cartCount = document.getElementById('cart-count');
  const cartTotal = document.getElementById('cart-total');

  quantities.forEach(quantity => {
    quantity.addEventListener('change', updateCart);
  });

  function updateCart() {
    cartItems.innerHTML = '';
    let totalCount = 0;
    let totalPrice = 0.0;

    quantities.forEach(quantity => {
      const qty = quantity.value;
      if (qty > 0) {
        const price = quantity.getAttribute('data-price');
        const itemTotal = qty * price;
        totalCount += parseInt(qty);
        totalPrice += itemTotal;

        const item = document.createElement('li');
        item.classList.add('list-group-item', 'd-flex', 'justify-content-between', 'lh-sm');
        item.innerHTML = `
          <div>
            <h6 class="my-0">${quantity.previousElementSibling.innerText}</h6>
            <small class="text-body-secondary">Quantity: ${qty}</small>
          </div>
          <span class="text-body-secondary">$${itemTotal.toFixed(2)}</span>
        `;
        cartItems.appendChild(item);
      }
    });

    cartCount.innerText = totalCount;
    cartTotal.innerText = `$${totalPrice.toFixed(2)}`;
  }

paypal.Buttons({
    createOrder: function(data, actions) {
        const items = getSelectedItems();
        const totalAmount = items.reduce((sum, item) => sum + item.price * item.quantity, 0).toFixed(2);

        return actions.order.create({
            purchase_units: [{
                amount: {
                    currency_code: "USD",
                    value: totalAmount,
                    breakdown: {
                        item_total: {
                            currency_code: "USD",
                            value: totalAmount
                        }
                    }
                },
                items: items.map(item => ({
                    name: item.name,
                    unit_amount: {
                        currency_code: 'USD',
                        value: item.price
                    },
                    quantity: item.quantity
                }))
            }]
        });
    },
    onApprove: function(data, actions) {
        return actions.order.capture().then(function(details) {
            window.location.href = "/thanks";
        });
    }
}).render('#paypal-button-container');

function getSelectedItems() {
    const selectedItems = [];
    const quantities = document.querySelectorAll('.product-quantity');
    quantities.forEach(quantity => {
        const qty = quantity.value;
        if (qty > 0) {
            selectedItems.push({
                name: quantity.previousElementSibling.innerText,
                quantity: qty,
                price: parseFloat(quantity.getAttribute('data-price'))
            });
        }
    });
    return selectedItems;
}


});
</script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
</body>
</html>
